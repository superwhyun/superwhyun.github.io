<!doctype html>
<html>

<head>

  <title>
    
      OpenAI - Auto Gamebot | U2PIA
    
  </title>

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta charset="utf-8">

  <link rel="stylesheet" href="/assets/css/main.css">
  <link rel="stylesheet" href="/assets/css/syntax.css">
  <!-- Use Atom -->
  <link type="application/atom+xml" rel="alternate" href="http://0.0.0.0:4000/feed.xml" title="U2PIA" />
  <!-- RSS-v2.0
  <link href="/rss-feed.xml" type="application/rss+xml" rel="alternate" title="U2PIA | Joy of learning"/>
  //-->


  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto|Source+Code+Pro">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css">

  <script type="text/javascript" async
    src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-MML-AM_CHTML">
  </script>

  <!-- Google Analytics -->
  <script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'superwhyun3@gmail.com', 'auto');
  ga('send', 'pageview');
</script>


  <!-- Use Jekyll SEO plugin -->
  <!-- Begin Jekyll SEO tag v2.4.0 -->
<title>OpenAI - Auto Gamebot | U2PIA</title>
<meta name="generator" content="Jekyll v3.6.2" />
<meta property="og:title" content="OpenAI - Auto Gamebot" />
<meta name="author" content="Wook Hyun" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="OpenAI를 이용한 Auto game bot 처음 시작하기" />
<meta property="og:description" content="OpenAI를 이용한 Auto game bot 처음 시작하기" />
<link rel="canonical" href="http://0.0.0.0:4000/documentation/openAI-gamebot.html" />
<meta property="og:url" content="http://0.0.0.0:4000/documentation/openAI-gamebot.html" />
<meta property="og:site_name" content="U2PIA" />
<meta property="og:image" content="http://0.0.0.0:4000/openai-gym.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2018-02-17T00:00:00-06:00" />
<script type="application/ld+json">
{"@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://0.0.0.0:4000/documentation/openAI-gamebot.html"},"url":"http://0.0.0.0:4000/documentation/openAI-gamebot.html","headline":"OpenAI - Auto Gamebot","dateModified":"2018-02-17T00:00:00-06:00","datePublished":"2018-02-17T00:00:00-06:00","description":"OpenAI를 이용한 Auto game bot 처음 시작하기","image":"http://0.0.0.0:4000/openai-gym.png","author":{"@type":"Person","name":"Wook Hyun"},"@context":"http://schema.org"}</script>
<!-- End Jekyll SEO tag -->


</head>


<body>

<div class="container">
  <header class="site-header">
  <h3 class="site-title">
    <a href="/">U2PIA</a>
  </h3>
  <nav class="menu-list">
    
      <a href="/pages/articles.html" class="menu-link">Articles</a>
    
      <a href="/pages/resources.html" class="menu-link">Learning Resources</a>
    
      <a href="/pages/upcoming.html" class="menu-link">Upcoming</a>
    
      <a href="/pages/documentation.html" class="menu-link">Documentation</a>
    
      <a href="/pages/tips.html" class="menu-link">Tips</a>
    
      <a href="/pages/about.html" class="menu-link">About</a>
    
      <a href="/pages/contact.html" class="menu-link">Contact</a>
    

    
      <a href="mailto:superwhyun3@gmail.com" class="menu-link" target="_blank"><i class="fa fa-envelope" aria-hidden="true"></i></a>
    
      <a href="feed.xml" class="menu-link" target="_blank"><i class="fa fa-rss-square" aria-hidden="true"></i></a>
    
  </nav>
  <div class="dropdown">
    <button class="dropbtn"><i class="fa fa-bars" aria-hidden="true"></i></button>
    <div class="dropdown-content">
      
        <a href="/pages/articles.html" class="menu-link">Articles</a>
      
        <a href="/pages/resources.html" class="menu-link">Learning Resources</a>
      
        <a href="/pages/upcoming.html" class="menu-link">Upcoming</a>
      
        <a href="/pages/documentation.html" class="menu-link">Documentation</a>
      
        <a href="/pages/tips.html" class="menu-link">Tips</a>
      
        <a href="/pages/about.html" class="menu-link">About</a>
      
        <a href="/pages/contact.html" class="menu-link">Contact</a>
      

      
        <a href="mailto:superwhyun3@gmail.com" class="menu-link" target="_blank"><i class="fa fa-envelope" aria-hidden="true"></i></a>
      
        <a href="feed.xml" class="menu-link" target="_blank"><i class="fa fa-rss-square" aria-hidden="true"></i></a>
      
    </div>
  </div>
</header>

  <div class="posts-wrapper">
    <div class="page-content">
  <h1>
    OpenAI - Auto Gamebot
  </h1>

  <span class="post-date">
    Written on
    
    February
    17th,
    2018
    by
    
      Wook Hyun
    
  </span>

  
    <div class="featured-image">
      <img src="/assets/img/openai-gym.png">
    </div>
  

  <article>
    <h2 id="openai를-이용한-auto-game-bot-처음-시작하기">OpenAI를 이용한 Auto game bot 처음 시작하기</h2>

<p>몇가지 게임을 docker container로 제공하고…
VNC를 이용해 원격으로 이미지를 받아오고…
이걸 가지고 ML 학습을 시키는 건데…</p>

<p>함 해보자..</p>

<p>https://www.youtube.com/watch?v=XI-I9i_GzIw&amp;index=6&amp;list=PL2-dafEMk2A64XaBlIUUI96yojneEfsuO
의 내용을 토대로 학습하였다.</p>

<p>다른 학자/교수들은 너무 기초부터 지루하게 설명하는데, 이 사람은 딱 사람들이 궁금해 하는 것에서 시작한다는 점에서 마음에 든다.</p>

<h3 id="openai">openAI</h3>

<p>아래 링크에 앵간한 설명 다 되어있다. 하라는 대로 하면 된다.
https://github.com/openai/universe</p>

<p>setup.py라는 것에 dependency, 설치되어야 할 패키지등이 기술되어 있다.
아래 명령어로 setup.py에 기재된 대로 일괄 설치시킨다. 난 python3을 쓸꺼니까 pip대신 pip3를 썼다.</p>

<blockquote>
  <p>pip3 install -e .</p>
</blockquote>

<p>아래 게임들이 docker image로 이미 만들어져 있다. 그래서, 일단 시작!하기 좋다. 뭔가 되는 것이 보여야 할 맛이 나지 않겠나?</p>
<ul>
  <li>Atari and CartPole environments over VNC: gym-core.Pong-v3, gym-core.CartPole-v0, etc.</li>
  <li>Flashgames over VNC: flashgames.DuskDrive-v0, etc.</li>
  <li>Browser tasks (“World of Bits”) over VNC: wob.mini.TicTacToe-v0, etc.</li>
</ul>

<p>게임의 화면을 VNC로 받아오게 해서 쓰는 것 같은데, 좀 많이 unstable할 것 같다.</p>

<h3 id="첫-걸음">첫 걸음</h3>

<p><a href="https://github.com/llSourcell/OpenAI_Game_Bot_Live_stream">여기</a>
에서 demo.py를 다운받아서 시작해 보자.</p>

<p>하라는대로 하면 될것 같지만, 세상 모든 일이 그러하듯 당연히 안될거다. 트러블을 잡아보자.</p>

<h4 id="trouble-shooting">Trouble shooting</h4>

<p>무작정 실행하면 다음 에러가 나올 수 있다. (안 나올 수도 있고~)</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>whyunui-MBP2017:OpenAI_Game_Bot_Live_stream whyun$ python demo.py 
Traceback (most recent call last):
  File "demo.py", line 2, in &lt;module&gt;
    import universe
  File "/Users/whyun/Devel/Projects/ML_gamebot/universe/universe/__init__.py", line 20, in &lt;module&gt;
    import universe.scoreboard
  File "/Users/whyun/Devel/Projects/ML_gamebot/universe/universe/scoreboard/__init__.py", line 1, in &lt;module&gt;
    from gym.benchmarks import scoring
ModuleNotFoundError: No module named 'gym.benchmarks'
</code></pre></div></div>

<p>이상하다. 분명 하라는대로 다 설치했는데? 
아래와 같이 해 보자.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>whyunui-MBP2017:OpenAI_Game_Bot_Live_stream whyun$ python
Python 3.6.2 (default, Jul 23 2017, 19:10:13) 
[GCC 4.2.1 Compatible Apple LLVM 8.1.0 (clang-802.0.42)] on darwin
Type "help", "copyright", "credits" or "license" for more information.
&gt;&gt;&gt; import gym
&gt;&gt;&gt; gym
&lt;module 'gym' from '/usr/local/lib/python3.6/site-packages/gym/__init__.py'&gt;
&gt;&gt;&gt; 
</code></pre></div></div>

<p>좀 뒤져보니… benchmarks 패키지가 gym에서 갑자기 사라졌다네? 곧 고치겠지만, 아래와 같이 낮은 버전으로 내리면 된다.
<a href="https://github.com/openai/universe/issues/228">참고</a></p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pip uninstall gym
pip install gym==0.9.5
</code></pre></div></div>

<p>그럼 될까?</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>whyunui-MBP2017:OpenAI_Game_Bot_Live_stream whyun$ python demo.py 
[2018-02-17 17:49:35,551] Making new env: flashgames.CoasterRacer-v0
Traceback (most recent call last):
  File "demo.py", line 93, in &lt;module&gt;
    main()	
  File "demo.py", line 39, in main
    observation_n = env.reset()
  File "/usr/local/lib/python3.6/site-packages/gym/core.py", line 104, in reset
    return self._reset()
  File "/Users/whyun/Devel/Projects/ML_gamebot/universe/universe/wrappers/timer.py", line 18, in _reset
    return self.env.reset()
  File "/usr/local/lib/python3.6/site-packages/gym/core.py", line 104, in reset
    return self._reset()
  File "/Users/whyun/Devel/Projects/ML_gamebot/universe/universe/wrappers/render.py", line 28, in _reset
    observation_n = self.env.reset()
  File "/usr/local/lib/python3.6/site-packages/gym/core.py", line 104, in reset
    return self._reset()
  File "/Users/whyun/Devel/Projects/ML_gamebot/universe/universe/wrappers/throttle.py", line 42, in _reset
    observation = self.env.reset()
  File "/usr/local/lib/python3.6/site-packages/gym/core.py", line 104, in reset
    return self._reset()
  File "/Users/whyun/Devel/Projects/ML_gamebot/universe/universe/envs/vnc_env.py", line 336, in _reset
    self._handle_connect()
  File "/Users/whyun/Devel/Projects/ML_gamebot/universe/universe/envs/vnc_env.py", line 510, in _handle_connect
    for remote in self.remote_manager.pop(n=n):
AttributeError: 'VNCEnv' object has no attribute 'remote_manager'
</code></pre></div></div>

<p>에이~ 그럼 재미 없지~!! (라고 말은 하지만 육두문자가 떠오른 것은 인지상정!)
좀 뒤져보니, env.configure(remotes=1)을 넣어줘야 한단다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">main</span><span class="p">():</span>

	<span class="c">#init environment</span>
	<span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s">'flashgames.CoasterRacer-v0'</span><span class="p">)</span>
	<span class="n">env</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">remotes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
	<span class="n">observation_n</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
</code></pre></div></div>

<p>다시 실행해 보자. 아래와 같이 docker image를 받아오는 것으 ㄹ볼 수 있다.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>whyunui-MBP2017:OpenAI_Game_Bot_Live_stream whyun$ !p
python demo.py 
[2018-02-17 18:00:29,906] Making new env: flashgames.CoasterRacer-v0
[2018-02-17 18:00:29,913] Writing logs to file: /tmp/universe-81183.log
[2018-02-17 18:00:29,952] Ports used: dict_keys([])
[2018-02-17 18:00:29,952] [0] Creating container: image=quay.io/openai/universe.flashgames:0.20.28. Run the same thing by hand as: docker run -p 5900:5900 -p 15900:15900 --privileged --cap-add SYS_ADMIN --ipc host quay.io/openai/universe.flashgames:0.20.28
[2018-02-17 18:00:29,986] Image quay.io/openai/universe.flashgames:0.20.28 not present locally; pulling
0.20.28: Pulling from openai/universe.flashgames
aed15891ba52: Pull complete
773ae8583d14: Pull complete
d1d48771f782: Pull complete
...
...
</code></pre></div></div>

<p>어, 뭔가 브라우저가 떴다가…. 먹통이 되삔네? 로그 메시지를 보자.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>[2018-02-17 18:02:36,113] Ports used: dict_keys([])
[2018-02-17 18:02:36,677] Remote closed: address=localhost:5901
[2018-02-17 18:02:36,679] At least one sockets was closed by the remote. Sleeping 1s...
universe-XBY3vd-0 | Setting VNC and rewarder password: openai
universe-XBY3vd-0 | [Sat Feb 17 09:02:40 UTC 2018] Waiting for /tmp/.X11-unix/X0 to be created (try 1/10)
universe-XBY3vd-0 | [Sat Feb 17 09:02:40 UTC 2018] [/usr/local/bin/sudoable-env-setup] Disabling outbound network traffic for none
universe-XBY3vd-0 | [init] [2018-02-17 09:02:40,891] Launching system_diagnostics_logger.py, recorder_logdir=/tmp/demo
universe-XBY3vd-0 | [tigervnc] 
universe-XBY3vd-0 | [tigervnc] Xvnc TigerVNC 1.7.0 - built Sep  8 2016 10:39:22
universe-XBY3vd-0 | [tigervnc] Copyright (C) 1999-2016 TigerVNC Team and many others (see README.txt)
universe-XBY3vd-0 | [tigervnc] See http://www.tigervnc.org for information on TigerVNC.
universe-XBY3vd-0 | [tigervnc] Underlying X server release 11400000, The X.Org Foundation
universe-XBY3vd-0 | [tigervnc] 
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension VNC-EXTENSION
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension Generic Event Extension
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension SHAPE
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension MIT-SHM
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension XInputExtension
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension XTEST
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension BIG-REQUESTS
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension SYNC
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension XKEYBOARD
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension XC-MISC
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension XINERAMA
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension XFIXES
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension RENDER
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension RANDR
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension COMPOSITE
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension DAMAGE
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension MIT-SCREEN-SAVER
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension DOUBLE-BUFFER
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension RECORD
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension DPMS
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension X-Resource
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension XVideo
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension XVideo-MotionCompensation
universe-XBY3vd-0 | [tigervnc] Initializing built-in extension GLX
universe-XBY3vd-0 | [tigervnc] 
universe-XBY3vd-0 | [tigervnc] Sat Feb 17 09:02:40 2018
universe-XBY3vd-0 | [tigervnc]  vncext:      VNC extension running!
universe-XBY3vd-0 | [tigervnc]  vncext:      Listening for VNC connections on all interface(s), port 5900
universe-XBY3vd-0 | [tigervnc]  vncext:      created VNC server for screen 0
universe-XBY3vd-0 | [tigervnc] [dix] Could not init font path element /usr/share/fonts/X11/Type1/, removing from list!
universe-XBY3vd-0 | [tigervnc] [dix] Could not init font path element /usr/share/fonts/X11/75dpi/, removing from list!
universe-XBY3vd-0 | [init] [2018-02-17 09:02:40,906] Launching reward_recorder.py, recorder_logdir=/tmp/demo
universe-XBY3vd-0 | [tigervnc] [dix] Could not init font path element /usr/share/fonts/X11/100dpi/, removing from list!
universe-XBY3vd-0 | [init] [2018-02-17 09:02:40,917] Launching vnc_recorder.py, recorder_logdir=/tmp/demo
universe-XBY3vd-0 | [init] [2018-02-17 09:02:40,927] PID 55 launched with command ['sudo', '-H', '-u', 'nobody', 'DISPLAY=:0', 'DBUS_SESSION_BUS_ADDRESS=/dev/null', '/app/universe-envs/controlplane/bin/controlplane.py', '--rewarder-port=15901']
universe-XBY3vd-0 | [init] [2018-02-17 09:02:41,043] init detected end of child process 59 with exit code 0, not killed by signal
universe-XBY3vd-0 | WebSocket server settings:
universe-XBY3vd-0 |   - Listen on :5898
universe-XBY3vd-0 |   - Flash security policy server
universe-XBY3vd-0 |   - No SSL/TLS support (no cert file)
universe-XBY3vd-0 |   - proxying from :5898 to localhost:5900
[2018-02-17 18:02:37,679] Remote closed: address=localhost:15901
[2018-02-17 18:02:37,681] Remote closed: address=localhost:5901
[2018-02-17 18:02:37,682] At least one sockets was closed by the remote. Sleeping 1s...
universe-XBY3vd-0 | [nginx] 2018/02/17 09:02:41 [error] 63#63: *1 connect() failed (111: Connection refused) while connecting to upstream, client: 172.17.0.1, server: , request: "GET / HTTP/1.1", upstream: "http://127.0.0.1:15901/", host: "127.0.0.1:10003"
universe-XBY3vd-0 | [nginx] 172.17.0.1 - openai [17/Feb/2018:09:02:41 +0000] "GET / HTTP/1.1" 502 182 "-" "-"
universe-XBY3vd-0 | [tigervnc] 
universe-XBY3vd-0 | [tigervnc] Sat Feb 17 09:02:41 2018
universe-XBY3vd-0 | [tigervnc]  Connections: accepted: 172.17.0.1::44036
universe-XBY3vd-0 | [vnc_recorder] [2018-02-17 09:02:41,714] Listening on 0.0.0.0:5899
universe-XBY3vd-0 | [reward_recorder] [2018-02-17 09:02:41,722] Listening on 0.0.0.0:15898
universe-XBY3vd-0 | [init] [2018-02-17 09:02:41,818] init detected end of child process 17 with exit code 0, not killed by signal
universe-XBY3vd-0 | [2018-02-17 09:02:41,939] [INFO:root] Starting play_controlplane.py with the following: command=['/app/universe-envs/controlplane/bin/controlplane.py', '--rewarder-port=15901'] args=Namespace(bot_demonstration=False, demonstration=False, env_id=None, idle_timeout=None, integrator_mode=False, no_env=False, no_rewarder=False, no_scorer=False, no_vexpect=False, remotes='vnc://127.0.0.1:5900', rewarder_fps=60, rewarder_port=15901, verbosity=0) env=environ({'TERM': 'xterm', 'HOME': '/nonexistent', 'SUDO_COMMAND': '/app/universe-envs/controlplane/bin/controlplane.py --rewarder-port=15901', 'HOSTNAME': 'c92bff94be55', 'SUDO_USER': 'root', 'SHELL': '/usr/sbin/nologin', 'PATH': '/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/snap/bin', 'SUDO_UID': '0', 'USERNAME': 'nobody', 'DISPLAY': ':0', 'LOGNAME': 'nobody', 'USER': 'nobody', 'DBUS_SESSION_BUS_ADDRESS': '/dev/null', 'SUDO_GID': '0', 'MAIL': '/var/mail/nobody'})
universe-XBY3vd-0 | [2018-02-17 09:02:41,939] [INFO:root] [EnvStatus] Changing env_state: None (env_id=None) -&gt; None (env_id=None) (episode_id: 0-&gt;0, fps=60)
universe-XBY3vd-0 | [2018-02-17 09:02:41,939] [INFO:universe.rewarder.remote] Starting Rewarder on port=15901
universe-XBY3vd-0 | [2018-02-17 09:02:41,942] [INFO:universe.extra.universe.wrappers.logger] Running VNC environments with Logger set to print_frequency=5. To change this, pass "print_frequency=k" or "print_frequency=None" to "env.configure".
universe-XBY3vd-0 | [2018-02-17 09:02:41,942] [INFO:universe.remotes.hardcoded_addresses] No rewarder addresses were provided, so this env cannot connect to the remote's rewarder channel, and cannot send control messages (e.g. reset)
universe-XBY3vd-0 | [2018-02-17 09:02:41,942] [INFO:universe.envs.vnc_env] Using the golang VNC implementation
universe-XBY3vd-0 | [2018-02-17 09:02:41,942] [INFO:universe.envs.vnc_env] Using VNCSession arguments: {'start_timeout': 7, 'compress_level': 9, 'encoding': 'zrle', 'fine_quality_level': 50, 'subsample_level': 2}. (Customize by running "env.configure(vnc_kwargs={...})"
universe-XBY3vd-0 | [2018-02-17 09:02:41,943] [INFO:universe.envs.vnc_env] Printed stats will ignore clock skew. (This usually makes sense only when the environment and agent are on the same machine.)
universe-XBY3vd-0 | [2018-02-17 09:02:41,950] [INFO:universe.envs.vnc_env] [0] Connecting to environment: vnc://127.0.0.1:5900 password=openai. If desired, you can manually connect a VNC viewer, such as TurboVNC. Most environments provide a convenient in-browser VNC client: http://None/viewer/?password=openai
universe-XBY3vd-0 | [2018-02-17 09:02:41,951] [INFO:universe.extra.universe.envs.vnc_env] [0] Connecting to environment details: vnc_address=127.0.0.1:5900 vnc_password=openai rewarder_address=None rewarder_password=openai
universe-XBY3vd-0 | 2018/02/17 09:02:41 I0217 09:02:41.951574 58 gymvnc.go:417] [0:127.0.0.1:5900] opening connection to VNC server
universe-XBY3vd-0 | [2018-02-17 09:02:41,952] [INFO:root] [EnvStatus] Changing env_state: None (env_id=None) -&gt; resetting (env_id=None) (episode_id: 0-&gt;1, fps=60)
universe-XBY3vd-0 | [2018-02-17 09:02:41,952] [INFO:root] [MainThread] Env state: env_id=None episode_id=1
universe-XBY3vd-0 | [2018-02-17 09:02:41,952] [INFO:root] [MainThread] Writing None to /tmp/demo/env_id.txt
universe-XBY3vd-0 | [tigervnc]  Connections: accepted: 127.0.0.1::59474
universe-XBY3vd-0 | [tigervnc]  SConnection: Client needs protocol version 3.8
universe-XBY3vd-0 | [tigervnc]  SConnection: Client requests security type VncAuth(2)
universe-XBY3vd-0 | [Sat Feb 17 09:02:41 UTC 2018] [/usr/local/bin/sudoable-env-setup] Disabling outbound network traffic for none
universe-XBY3vd-0 | [2018-02-17 09:02:41,975] [INFO:gym_flashgames.launcher] [MainThread] Launching new Chrome process (attempt 0/10)
universe-XBY3vd-0 | [2018-02-17 09:02:41,975] [INFO:root] Replacing selenium_wrapper_server since we currently do it at every episode boundary
universe-XBY3vd-0 | [tigervnc]  VNCSConnST:  Server default pixel format depth 24 (32bpp) little-endian rgb888
universe-XBY3vd-0 | 2018/02/17 09:02:41 I0217 09:02:41.983761 58 gymvnc.go:550] [0:127.0.0.1:5900] connection established
universe-XBY3vd-0 | [tigervnc]  VNCSConnST:  Client pixel format depth 24 (32bpp) little-endian bgr888
universe-XBY3vd-0 | [2018-02-17 09:02:42,125] [selenium_wrapper_server] Calling webdriver.Chrome()
[2018-02-17 18:02:38,688] Using the golang VNC implementation
[2018-02-17 18:02:38,688] Using VNCSession arguments: {'start_timeout': 7, 'encoding': 'tight', 'fine_quality_level': 50, 'subsample_level': 2}. (Customize by running "env.configure(vnc_kwargs={...})"
universe-XBY3vd-0 | [tigervnc] 
universe-XBY3vd-0 | [tigervnc] Sat Feb 17 09:02:42 2018
universe-XBY3vd-0 | [nginx] 2018/02/17 09:02:42 [info] 63#63: *1 client 172.17.0.1 closed keepalive connection
universe-XBY3vd-0 | [tigervnc]  Connections: closed: 172.17.0.1::44036 (Clean disconnection)
universe-XBY3vd-0 | [tigervnc]  EncodeManager: Framebuffer updates: 0
universe-XBY3vd-0 | [tigervnc]  EncodeManager:   Total: 0 rects, 0 pixels
universe-XBY3vd-0 | [tigervnc]  EncodeManager:          0 B (1:-nan ratio)
[2018-02-17 18:02:38,695] [0] Connecting to environment: vnc://localhost:5901 password=openai. If desired, you can manually connect a VNC viewer, such as TurboVNC. Most environments provide a convenient in-browser VNC client: http://localhost:15901/viewer/?password=openai
2018/02/17 18:02:38 I0217 18:02:38.695987 81183 gymvnc.go:417] [0:localhost:5901] opening connection to VNC server
universe-XBY3vd-0 | [tigervnc]  Connections: accepted: 172.17.0.1::44042
universe-XBY3vd-0 | [tigervnc]  SConnection: Client needs protocol version 3.8
2018/02/17 18:02:38 I0217 18:02:38.708281 81183 gymvnc.go:550] [0:localhost:5901] connection established
universe-XBY3vd-0 | [tigervnc]  SConnection: Client requests security type VncAuth(2)
universe-XBY3vd-0 | [tigervnc]  VNCSConnST:  Server default pixel format depth 24 (32bpp) little-endian rgb888
universe-XBY3vd-0 | [tigervnc]  VNCSConnST:  Client pixel format depth 24 (32bpp) little-endian bgr888
universe-XBY3vd-0 | [2018-02-17 09:02:42,563] [INFO:universe.rewarder.remote] Client connecting: peer=tcp4:127.0.0.1:54308 observer=False
universe-XBY3vd-0 | [2018-02-17 09:02:42,563] [INFO:universe.rewarder.remote] WebSocket connection established
universe-XBY3vd-0 | [nginx] 2018/02/17 09:02:44 [info] 63#63: *5 client sent invalid request while reading client request line, client: 127.0.0.1, server: , request: "CONNECT www.google.com:443 HTTP/1.1"
universe-XBY3vd-0 | [nginx] 2018/02/17 09:02:44 [info] 63#63: *6 client sent invalid request while reading client request line, client: 127.0.0.1, server: , request: "CONNECT www.google.com:443 HTTP/1.1"
universe-XBY3vd-0 | [nginx] 2018/02/17 09:02:44 [info] 63#63: *7 client sent invalid request while reading client request line, client: 127.0.0.1, server: , request: "CONNECT www.google.com:443 HTTP/1.1"
universe-XBY3vd-0 | [2018-02-17 09:02:44,974] [selenium_wrapper_server] Call to webdriver.Chrome() completed: 2.85s
universe-XBY3vd-0 | [2018-02-17 09:02:44,975] [INFO:gym_flashgames.launcher] [MainThread] Navigating browser to url=http://localhost
[2018-02-17 18:02:41,128] Throttle fell behind by 2.39s; lost 143.68 frames
universe-XBY3vd-0 | [2018-02-17 09:02:45,068] [INFO:root] [EnvStatus] Changing env_state: resetting (env_id=None) -&gt; running (env_id=None) (episode_id: 1-&gt;1, fps=60)
universe-XBY3vd-0 | [2018-02-17 09:02:45,074] [INFO:root] [MainThread] Writing None to /tmp/demo/env_id.txt
universe-XBY3vd-0 | Manhole[1518858165.0809]: Patched &lt;built-in function fork&gt; and &lt;built-in function fork&gt;.
universe-XBY3vd-0 | Manhole[1518858165.0814]: Manhole UDS path: /tmp/manhole-58
universe-XBY3vd-0 | Manhole[1518858165.0922]: Waiting for new connection (in pid:58) ...
universe-XBY3vd-0 | [2018-02-17 09:02:46,966] [INFO:universe.wrappers.logger] Stats for the past 5.01s: vnc_updates_ps=3.8 n=1 reaction_time=None observation_lag=None action_lag=None reward_ps=0.0 reward_total=0.0 vnc_bytes_ps[total]=357957.6 vnc_pixels_ps[total]=532999.9 reward_lag=None rewarder_message_lag=None fps=22.74
universe-XBY3vd-0 | [2018-02-17 09:02:50,080] [INFO:universe.pyprofile] [pyprofile] period=5.00s timers={"rewarder.compute_reward": {"mean": "411.29us", "calls": 301, "std": "182.74us"}, "vnc_env.VNCEnv.vnc_session.step": {"mean": "169.31us", "calls": 301, "std": "92.46us"}, "rewarder.sleep": {"mean": "15.45ms", "calls": 300, "std": "670.98us"}, "rewarder.frame": {"mean": "17.37ms", "calls": 300, "std": "611.00us"}} counters={"reward.vnc.updates.n": {"mean": 0.06312292358803995, "calls": 301, "std": 0.6678339725107008}} gauges={} (export_time=121.83us)
universe-XBY3vd-0 | [2018-02-17 09:02:50,080] [INFO:universe.rewarder.remote] [Rewarder] Over past 5.00s, sent 1 reward messages to agent: reward=0 reward_min=0 reward_max=0 done=False info={'rewarder.vnc.updates.pixels': 0, 'rewarder.vnc.updates.n': 0, 'rewarder.vnc.updates.bytes': 0, 'rewarder.profile': '&lt;763 bytes&gt;'}
universe-XBY3vd-0 | [2018-02-17 09:02:51,981] [INFO:universe.wrappers.logger] Stats for the past 5.01s: vnc_updates_ps=0.0 n=1 reaction_time=None observation_lag=None action_lag=None reward_ps=0.0 reward_total=0.0 vnc_bytes_ps[total]=0.0 vnc_pixels_ps[total]=0.0 reward_lag=None rewarder_message_lag=None fps=60.03
universe-XBY3vd-0 | [2018-02-17 09:02:55,080] [INFO:universe.pyprofile] [pyprofile] period=5.00s timers={"rewarder.compute_reward": {"mean": "440.98us", "calls": 300, "std": "189.32us"}, "vnc_env.VNCEnv.vnc_session.step": {"mean": "177.15us", "calls": 300, "std": "93.70us"}, "rewarder.sleep": {"mean": "15.29ms", "calls": 300, "std": "603.19us"}, "rewarder.frame": {"mean": "17.48ms", "calls": 300, "std": "496.74us"}} counters={"agent_conn.reward": {"mean": 0.0, "calls": 1, "std": 0}, "reward.vnc.updates.n": {"mean": 0.0, "calls": 300, "std": 0.0}} gauges={} (export_time=115.39us)
universe-XBY3vd-0 | [2018-02-17 09:02:55,080] [INFO:universe.rewarder.remote] [Rewarder] Over past 5.00s, sent 1 reward messages to agent: reward=0 reward_min=0 reward_max=0 done=False info={'rewarder.vnc.updates.pixels': 0, 'rewarder.vnc.updates.n': 0, 'rewarder.vnc.updates.bytes': 0, 'rewarder.profile': '&lt;804 bytes&gt;'}
universe-XBY3vd-0 | [2018-02-17 09:02:56,997] [INFO:universe.wrappers.logger] Stats for the past 5.01s: vnc_updates_ps=0.0 n=1 reaction_time=None observation_lag=None action_lag=None reward_ps=0.0 reward_total=0.0 vnc_bytes_ps[total]=0.0 vnc_pixels_ps[total]=0.0 reward_lag=None rewarder_message_lag=None fps=60.02
universe-XBY3vd-0 | [2018-02-17 09:03:00,081] [INFO:universe.pyprofile] [pyprofile] period=5.00s timers={"rewarder.compute_reward": {"mean": "391.47us", "calls": 300, "std": "172.18us"}, "vnc_env.VNCEnv.vnc_session.step": {"mean": "150.89us", "calls": 300, "std": "76.76us"}, "rewarder.sleep": {"mean": "15.44ms", "calls": 300, "std": "562.19us"}, "rewarder.frame": {"mean": "17.39ms", "calls": 300, "std": "466.06us"}} counters={"agent_conn.reward": {"mean": 0.0, "calls": 1, "std": 0}, "reward.vnc.updates.n": {"mean": 0.0, "calls": 300, "std": 0.0}} gauges={} (export_time=112.53us)
universe-XBY3vd-0 | [2018-02-17 09:03:00,081] [INFO:universe.rewarder.remote] [Rewarder] Over past 5.00s, sent 1 reward messages to agent: reward=0 reward_min=0 reward_max=0 done=False info={'rewarder.vnc.updates.pixels': 0, 'rewarder.vnc.updates.n': 0, 'rewarder.vnc.updates.bytes': 0, 'rewarder.profile': '&lt;803 bytes&gt;'}
universe-XBY3vd-0 | [2018-02-17 09:03:02,013] [INFO:universe.wrappers.logger] Stats for the past 5.02s: vnc_updates_ps=0.0 n=1 reaction_time=None observation_lag=None action_lag=None reward_ps=0.0 reward_total=0.0 vnc_bytes_ps[total]=0.0 vnc_pixels_ps[total]=0.0 reward_lag=None rewarder_message_lag=None fps=60.01
[2018-02-17 18:03:01,127] [0:localhost:5901] ntpdate -q -p 8 localhost call timed out after 20.0s; killing the subprocess. This is ok, but you could have more accurate timings by enabling UDP port 123 traffic to your env. (Alternatively, you can try increasing the timeout by setting environment variable UNIVERSE_NTPDATE_TIMEOUT=10.)
universe-XBY3vd-0 | [nginx] 2018/02/17 09:03:05 [info] 63#63: *10 client closed connection while waiting for request, client: 172.17.0.1, server: 0.0.0.0:15900
universe-XBY3vd-0 | [nginx] 2018/02/17 09:03:05 [info] 63#63: *11 client closed connection while waiting for request, client: 172.17.0.1, server: 0.0.0.0:15900
universe-XBY3vd-0 | [nginx] 2018/02/17 09:03:05 [info] 63#63: *12 client closed connection while waiting for request, client: 172.17.0.1, server: 0.0.0.0:15900
universe-XBY3vd-0 | [nginx] 2018/02/17 09:03:05 [info] 63#63: *13 client closed connection while waiting for request, client: 172.17.0.1, server: 0.0.0.0:15900
universe-XBY3vd-0 | [nginx] 2018/02/17 09:03:05 [info] 63#63: *14 client closed connection while waiting for request, client: 172.17.0.1, server: 0.0.0.0:15900
universe-XBY3vd-0 | [nginx] 2018/02/17 09:03:05 [info] 63#63: *15 client closed connection while waiting for request, client: 172.17.0.1, server: 0.0.0.0:15900
universe-XBY3vd-0 | [nginx] 2018/02/17 09:03:05 [info] 63#63: *16 client closed connection while waiting for request, client: 172.17.0.1, server: 0.0.0.0:15900
universe-XBY3vd-0 | [nginx] 2018/02/17 09:03:05 [info] 63#63: *17 client closed connection while waiting for request, client: 172.17.0.1, server: 0.0.0.0:15900
universe-XBY3vd-0 | [nginx] 2018/02/17 09:03:05 [info] 63#63: *18 client closed connection while waiting for request, client: 172.17.0.1, server: 0.0.0.0:15900
universe-XBY3vd-0 | [nginx] 2018/02/17 09:03:05 [info] 63#63: *19 client closed connection while waiting for request, client: 172.17.0.1, server: 0.0.0.0:15900
universe-XBY3vd-0 | [2018-02-17 09:03:05,038] [INFO:universe.rewarder.remote] CONNECTION STATUS: Marking connection as active: observer=False peer=tcp4:127.0.0.1:54308 total_conns=1
[2018-02-17 18:03:01,187] [0:localhost:5901] Sending reset for env_id=flashgames.CoasterRacer-v0 fps=60 episode_id=0
universe-XBY3vd-0 | [2018-02-17 09:03:05,063] [INFO:universe.rewarder.remote] Received reset message: {'headers': {'episode_id': '0', 'message_id': 10, 'sent_at': 1518858181.187246}, 'body': {'seed': None, 'env_id': 'flashgames.CoasterRacer-v0', 'fps': 60}, 'method': 'v0.env.reset'}
universe-XBY3vd-0 | [2018-02-17 09:03:05,070] [INFO:root] [EnvStatus] Changing env_state: running (env_id=None) -&gt; resetting (env_id=flashgames.CoasterRacer-v0) (episode_id: 1-&gt;2, fps=60)
universe-XBY3vd-0 | [2018-02-17 09:03:05,073] [ERROR:root] Closing server (via subprocess.close()) and all chromes (via pkill chromedriver || :; pkill chrome || :)
universe-XBY3vd-0 | [2018-02-17 09:03:05,079] [INFO:root] [Rewarder] Blocking until env finishes resetting
universe-XBY3vd-0 | [init] [2018-02-17 09:03:05,088] init detected end of child process 111 with exit code 0, killed by SIGTERM: 15
universe-XBY3vd-0 | [2018-02-17 09:03:05,091] [INFO:root] [EnvController] RESET CAUSE: changing out environments due to v0.env.reset (with episode_id=0): flashgames.CoasterRacer-v0 -&gt; flashgames.CoasterRacer-v0 (new episode_id=2 fps=60)
universe-XBY3vd-0 | [2018-02-17 09:03:05,092] [INFO:root] [EnvController] Env state: env_id=flashgames.CoasterRacer-v0 episode_id=2
universe-XBY3vd-0 | [2018-02-17 09:03:05,092] [INFO:root] [EnvController] Writing flashgames.CoasterRacer-v0 to /tmp/demo/env_id.txt
universe-XBY3vd-0 | [init] [2018-02-17 09:03:05,102] init detected end of child process 126 with exit code 0, not killed by signal
universe-XBY3vd-0 | [init] [2018-02-17 09:03:05,103] init detected end of child process 332 with exit code 0, killed by SIGTERM: 15
universe-XBY3vd-0 | [init] [2018-02-17 09:03:05,103] init detected end of child process 348 with exit code 0, killed by SIGTERM: 15
universe-XBY3vd-0 | [nginx] 2018/02/17 09:03:05 [info] 63#63: *9 client closed connection while waiting for request, client: 127.0.0.1, server: 0.0.0.0:80
universe-XBY3vd-0 | [nginx] 2018/02/17 09:03:05 [info] 63#63: *8 client 127.0.0.1 closed keepalive connection
universe-XBY3vd-0 | [Sat Feb 17 09:03:05 UTC 2018] [/usr/local/bin/sudoable-env-setup] Allowing outbound network traffic to non-private IPs for git-lfs. (Going to fetch files via git lfs.)
universe-XBY3vd-0 | [init] [2018-02-17 09:03:05,160] init detected end of child process 125 with exit code 0, killed by SIGTERM: 15
universe-XBY3vd-0 | [init] [2018-02-17 09:03:05,160] init detected end of child process 122 with exit code 0, not killed by signal
universe-XBY3vd-0 | [init] [2018-02-17 09:03:05,160] init detected end of child process 123 with exit code 0, not killed by signal
universe-XBY3vd-0 | [init] [2018-02-17 09:03:05,161] init detected end of child process 114 with exit code 0, not killed by signal
universe-XBY3vd-0 | [unpack-lfs] [2018-02-17 09:03:05,240] Fetching files: git lfs pull -I git-lfs/flashgames.CoasterRacer-v0.tar.gz
universe-XBY3vd-0 | [unpack-lfs] [2018-02-17 09:03:05,242] If this hangs, your docker container may not be able to communicate with Github
universe-XBY3vd-0 | [nginx] 2018/02/17 09:04:05 [info] 63#63: *3 upstream timed out (110: Connection timed out) while proxying upgraded connection, client: 172.17.0.1, server: , request: "GET / HTTP/1.1", upstream: "http://127.0.0.1:15901/", host: "localhost:15901"
universe-XBY3vd-0 | [nginx] 172.17.0.1 - openai [17/Feb/2018:09:04:05 +0000] "GET / HTTP/1.1" 101 4455 "-" "AutobahnPython/17.10.1"
universe-XBY3vd-0 | [2018-02-17 09:04:05,090] [INFO:universe.rewarder.remote] WebSocket connection closed: connection was closed uncleanly (peer dropped the TCP connection without previous WebSocket closing handshake)
[2018-02-17 18:04:01,150] [0] Closing rewarder connection
universe-XBY3vd-0 | [2018-02-17 09:04:05,091] [INFO:universe.rewarder.remote] [Twisted] Active client disconnected (sent 11 messages). Still have 0 active clients left
Traceback (most recent call last):
  File "demo.py", line 94, in &lt;module&gt;
universe-XBY3vd-0 | [tigervnc] 
universe-XBY3vd-0 | [tigervnc] Sat Feb 17 09:04:05 2018
universe-XBY3vd-0 | [tigervnc]  Connections: closed: 172.17.0.1::44042 (Clean disconnection)
universe-XBY3vd-0 | [tigervnc]  EncodeManager: Framebuffer updates: 20
universe-XBY3vd-0 | [tigervnc]  EncodeManager:   Tight:
universe-XBY3vd-0 | [tigervnc]  EncodeManager:     Solid: 43 rects, 2.50697 Mpixels
universe-XBY3vd-0 | [tigervnc]  EncodeManager:            688 B (1:14576.1 ratio)
universe-XBY3vd-0 | [tigervnc]  EncodeManager:     Bitmap RLE: 8 rects, 52.512 kpixels
universe-XBY3vd-0 | [tigervnc]  EncodeManager:                 415 B (1:506.371 ratio)
universe-XBY3vd-0 | [tigervnc]  EncodeManager:     Indexed RLE: 24 rects, 314.46 kpixels
universe-XBY3vd-0 | [tigervnc]  EncodeManager:                  11.2979 KiB (1:108.75 ratio)
universe-XBY3vd-0 | [tigervnc]  EncodeManager:   Tight (JPEG):
universe-XBY3vd-0 | [tigervnc]  EncodeManager:     Full Colour: 14 rects, 549.336 kpixels
universe-XBY3vd-0 | [tigervnc]  EncodeManager:                  106.937 KiB (1:20.0681 ratio)
universe-XBY3vd-0 | [tigervnc]  EncodeManager:   Total: 89 rects, 3.42328 Mpixels
universe-XBY3vd-0 | [tigervnc]  EncodeManager:          119.312 KiB (1:112.087 ratio)
    main()	
  File "demo.py", line 89, in main
    observation_n, reward_n, done_n, info = env.step(action_n)
  File "/usr/local/lib/python3.6/site-packages/gym/core.py", line 96, in step
    return self._step(action)
  File "/Users/whyun/Devel/Projects/ML_gamebot/universe/universe/wrappers/timer.py", line 23, in _step
    observation_n, reward_n, done_n, info = self.env.step(action_n)
  File "/usr/local/lib/python3.6/site-packages/gym/core.py", line 96, in step
    return self._step(action)
  File "/Users/whyun/Devel/Projects/ML_gamebot/universe/universe/wrappers/render.py", line 33, in _step
    observation_n, reward_n, done_n, info_n = self.env.step(action_n)
  File "/usr/local/lib/python3.6/site-packages/gym/core.py", line 96, in step
    return self._step(action)
  File "/Users/whyun/Devel/Projects/ML_gamebot/universe/universe/wrappers/throttle.py", line 51, in _step
    accum_observation_n, accum_reward_n, accum_done_n, accum_info = self._substep(action_n)
  File "/Users/whyun/Devel/Projects/ML_gamebot/universe/universe/wrappers/throttle.py", line 132, in _substep
    observation_n, reward_n, done_n, info = self.env.step(action_n)
  File "/usr/local/lib/python3.6/site-packages/gym/core.py", line 96, in step
    return self._step(action)
  File "/Users/whyun/Devel/Projects/ML_gamebot/universe/universe/envs/vnc_env.py", line 464, in _step
    self._handle_crashed_n(info_n)
  File "/Users/whyun/Devel/Projects/ML_gamebot/universe/universe/envs/vnc_env.py", line 537, in _handle_crashed_n
    raise error.Error('{}/{} environments have crashed! Most recent error: {}'.format(len(self.crashed), self.n, errors))
universe.error.Error: 1/1 environments have crashed! Most recent error: {'0': 'Rewarder session failed: Lost connection: connection was closed uncleanly (peer dropped the TCP connection without previous WebSocket closing handshake) (clean=False code=1006)'}
universe-XBY3vd-0 | [unpack-lfs] [2018-02-17 09:04:05,247] git lfs timed out after 60 seconds. Your docker container probably can't communicate with Github.
universe-XBY3vd-0 | It is fetching from https://github.com/, so make sure your container can connect to public addresses on port 443.
[2018-02-17 18:04:01,338] Killing and removing container: id=c92bff94be55d030bf78246de5c46fb9f377571db256c23b0953f30484e855db
</code></pre></div></div>

<p>뭔가 학습이 진행 되다가… 죽은것 같다. 
다시 실행해 본다. 
어! 된다!
어? 근데 곧 죽었다.
뭔가 소켓쪽 에러가 마구 뿜뿜한다.</p>

<p>openai 공식홈페이지에서 제공하는 예제를 가지고 다시 해보자.</p>
<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="nn">gym</span>
<span class="kn">import</span> <span class="nn">universe</span>  <span class="c"># register the universe environments</span>

<span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s">'flashgames.DuskDrive-v0'</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">configure</span><span class="p">(</span><span class="n">remotes</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c"># automatically creates a local docker container</span>
<span class="n">observation_n</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
  <span class="n">action_n</span> <span class="o">=</span> <span class="p">[[(</span><span class="s">'KeyEvent'</span><span class="p">,</span> <span class="s">'ArrowUp'</span><span class="p">,</span> <span class="bp">True</span><span class="p">)]</span> <span class="k">for</span> <span class="n">ob</span> <span class="ow">in</span> <span class="n">observation_n</span><span class="p">]</span>  <span class="c"># your agent here</span>
  <span class="n">observation_n</span><span class="p">,</span> <span class="n">reward_n</span><span class="p">,</span> <span class="n">done_n</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action_n</span><span class="p">)</span>
  <span class="n">env</span><span class="o">.</span><span class="n">render</span><span class="p">()</span>
</code></pre></div></div>

<p>잘 된다. 근데 얘는 UP 버튼만 누르기 때문에 수천번 돌려도 아무짝에 쓸모 없다.
그래서 원래 하려던 코드에 나와있는 게임을 교체했더니 잘 동작한다.</p>

<div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># env = gym.make('flashgames.CoasterRacer-v0')</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">gym</span><span class="o">.</span><span class="n">make</span><span class="p">(</span><span class="s">'flashgames.DuskDrive-v0'</span><span class="p">)</span>
</code></pre></div></div>

<!-- ![openai screen](openai.png){:class="img-responsive"} -->
<p><img src="/assets/img/openai.png" alt="openai flashgame screenshot" class="img-responsive" /></p>

<p>찬찬히 까보자. 
도커 이미지는 다음을 포함하는 것 같다.</p>
<ul>
  <li>flashgame</li>
  <li>vnc server</li>
  <li>chrome</li>
  <li>web server</li>
  <li>websocket server</li>
</ul>

<p>독특한게, 대개의 docker image/container는 server program이 구동되는 것이 통상적인데, 얘네는 마치 virtual desktop environment가 돌아가는 것 같다. 굉장히 특이하긴 한데, 다른 곳에 응용할 수 있는 가능성을 보여준 것이 꽤 흥미롭다.
GUI application이 docker image에 들어가게 하는 방법은 <a href="https://stackoverflow.com/questions/16296753/can-you-run-gui-apps-in-a-docker-container">여기</a>의 내용을 참고하자.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>...
quay.io/openai/universe.flashgames   0.20.28             e55f692f7c56        11 months ago       1.75GB
...
</code></pre></div></div>

<p>이 이미지/컨테이너가 하는 일이 뭔지 보는 가장 좋은 방법은 Dockerfile을 까 보는 것!!</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="s">FROM ubuntu:16.04</span>

<span class="s">RUN apt-get update \</span>
    <span class="s">&amp;&amp; apt-get install -y libav-tools \</span>
    <span class="s">python3-numpy \</span>
    <span class="s">python3-scipy \</span>
    <span class="s">python3-setuptools \</span>
    <span class="s">python3-pip \</span>
    <span class="s">libpq-dev \</span>
    <span class="s">libjpeg-dev \</span>
    <span class="s">curl \</span>
    <span class="s">cmake \</span>
    <span class="s">swig \</span>
    <span class="s">python3-opengl \</span>
    <span class="s">libboost-all-dev \</span>
    <span class="s">libsdl2-dev \</span>
    <span class="s">wget \</span>
    <span class="s">unzip \</span>
    <span class="s">git \</span>
    <span class="s">golang \</span>
    <span class="s">net-tools \</span>
    <span class="s">iptables \</span>
    <span class="s">libvncserver-dev \</span>
    <span class="s">software-properties-common \</span>
    <span class="s">&amp;&amp; apt-get clean \</span>
    <span class="s">&amp;&amp; rm -rf /var/lib/apt/lists/*</span>

<span class="s">RUN ln -sf /usr/bin/pip3 /usr/local/bin/pip \</span>
    <span class="s">&amp;&amp; ln -sf /usr/bin/python3 /usr/local/bin/python \</span>
    <span class="s">&amp;&amp; pip install -U pip</span>

<span class="c1"># Install gym</span>
<span class="s">RUN pip install gym[all]</span>

<span class="c1"># Get the faster VNC driver</span>
<span class="s">RUN pip install go-vncdriver&gt;=0.4.0</span>

<span class="c1"># Install pytest (for running test cases)</span>
<span class="s">RUN pip install pytest</span>

<span class="c1"># Force the container to use the go vnc driver</span>
<span class="s">ENV UNIVERSE_VNCDRIVER='go'</span>

<span class="s">WORKDIR /usr/local/universe/</span>

<span class="c1"># Cachebusting</span>
<span class="s">COPY ./setup.py ./</span>
<span class="s">COPY ./tox.ini ./</span>

<span class="s">RUN pip install -e .</span>

<span class="c1"># Upload our actual code</span>
<span class="s">COPY . ./</span>

<span class="c1"># Just in case any python cache files were carried over from the source directory, remove them</span>
<span class="s">RUN py3clean .</span>

</code></pre></div></div>

<p>대충 눈여겨 봐야 할 것으로..</p>
<ul>
  <li>go-vncdriver : vnc viewer 역할을 하면서 vnc server로부터 영상(스냅샷?)을 수집하는 기능</li>
  <li>pytest : 단위별 기능테스트 하는 패키지</li>
  <li>gym[atari] in setup.py</li>
</ul>

<p>등이 있다.</p>

<p>또 하나 눈여겨 볼 것이 최종 실행 명령이 없이, 설치에 관련된 명령만이 나열되어 있다는 점이다. 실행을 위한 명령은 다른 곳에서 공급받는 다는 얘기. 
로그 파일을 잘 들여다보면, command=[‘/app/universe-envs/controlplane/bin/controlplane.py’, ‘–rewarder-port=15901’] 이 있는데, 얘가 실제 관련 프로그램 구동을 담당하는 듯 하고, 15901 포트는 웹소켓 포트로 reward가 발생하면 값을 전달해 주는 포트로 보인다.</p>

<p>도커 컨테이너 내의 브라우저는 Chrome WebDriver를 이용했다. 완전 웹쪽 전문가(특히 브라우저 개발자)가 붙어 있는 모양이다.</p>

<p>어쨌든 궁금했던 것은 다음과 같다.</p>

<ul>
  <li>게임을 어떻게 시작되도록 하는가? 클릭되어야 할 좌표는 미리 입력하는 건가?
    <ul>
      <li>ㅇㅇ. 게임별 environment가 있고, 게임을 start 하기 위한 마우스 좌표 등을 미리 포함시키도록 하고 있음.</li>
    </ul>
  </li>
  <li>reward는 어떻게 알아내는가? 즉, 성공/실패 여부는 어떻게 알아내지?
    <ul>
      <li>이것도 미리.. 정해놔야 함.</li>
    </ul>
  </li>
  <li>VNC에서 화면 데이터를 읽어서 어떻게 처리하는가?
    <ul>
      <li>처리하지 않음. universe에서 다 해줌.</li>
    </ul>
  </li>
  <li>학습된 모델을 save/load 할 수 있는가?
    <ul>
      <li>만들면 됨. 별로 어렵진 않음.</li>
    </ul>
  </li>
</ul>

<h2 id="잠정-결론">잠정 결론..</h2>

<p><strong>이거 뭐에 써먹지?</strong></p>


  </article>

  
  <div id="disqus_thread"></div>
  <script>
  
  /**
  *  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
  *  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
  /*
  var disqus_config = function () {
  this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
  this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
  };
  */
  (function() { // DON'T EDIT BELOW THIS LINE
  var d = document, s = d.createElement('script');
  s.src = 'https://superwhyun.disqus.com/embed.js';
  s.setAttribute('data-timestamp', +new Date());
  (d.head || d.body).appendChild(s);
  })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>                           



  <div class="post-share">
    <div class="post-date">Feel free to share!</div>
    <div class="sharing-icons">
      <a href="https://twitter.com/intent/tweet?text=OpenAI - Auto Gamebot&amp;url=/documentation/openAI-gamebot.html" target="_blank"><i class="fa fa-twitter" aria-hidden="true"></i></a>
      <a href="https://www.facebook.com/sharer/sharer.php?u=/documentation/openAI-gamebot.html&amp;title=OpenAI - Auto Gamebot" target="_blank"><i class="fa fa-facebook" aria-hidden="true"></i></a>
      <a href="https://plus.google.com/share?url=/documentation/openAI-gamebot.html" target="_blank"><i class="fa fa-google-plus" aria-hidden="true"></i></a>
    </div>
  </div>

  <div class="related">
    <h2>You may also enjoy...</h2>
    
    <ul class="related-posts">
      
        
          
            <li>
              <h3>
                <a href="/documentation/python-opencv.html">
                  <div class="related-thumbnail">
                    
                      <img src="http://0.0.0.0:4000/assets/img/nature-1.jpg">
                    
                  </div>
                  <div class="related-title">
                    Python에서 OpenCV 사용하기
                  </div>
                  <!--<small>December 19, 2018</small>-->
                </a>
              </h3>
            </li>
            
          
        
          
            <li>
              <h3>
                <a href="/tips/python-exec.html">
                  <div class="related-thumbnail">
                    
                      <img src="http://0.0.0.0:4000/assets/img/nature-1.jpg">
                    
                  </div>
                  <div class="related-title">
                    Python에서 fork, exec등을 위한 subprocess 사용법
                  </div>
                  <!--<small>December 19, 2018</small>-->
                </a>
              </h3>
            </li>
            
          
        
      
    </ul>
  </div>

  

</div>

  </div>
  <footer class="footer">
  
    <a href="mailto:superwhyun3@gmail.com" class="menu-link" target="_blank"><i class="fa fa-envelope" aria-hidden="true"></i></a>
  
    <a href="feed.xml" class="menu-link" target="_blank"><i class="fa fa-rss-square" aria-hidden="true"></i></a>
  
  <div class="post-date"><a href="/">U2PIA | Joy of learning by Wook Hyun</a></div>
</footer>

</div>

</body>
</html>
